# HITL 프롬프트 가디언 (Prompt Guardian)

LangGraph 기반 Human-in-the-Loop 프롬프트 최적화 도구

## 개요

사용자의 모호한 프롬프트를 분석하여 점수를 매기고, 4가지 개선 선택지를 통해 최적의 프롬프트를 완성합니다.

## 아키텍처

```
┌──────────────┐
│  사용자 입력  │
└──────┬───────┘
       ▼
┌──────────────┐
│  judge_node  │ ← 점수 평가 (0-100) + 4개 선택지 생성
└──────┬───────┘
       │
   ┌───┴───┐
   ▼       ▼
 ≥80점   <80점
   │       │
   ▼       ▼
┌─────┐  ┌─────────────┐
│ END │  │ human_input │ ← interrupt_before (사용자 선택 대기)
└─────┘  └──────┬──────┘
                ▼
         ┌─────────────┐
         │ refine_node │ ← 선택 반영하여 프롬프트 재작성
         └──────┬──────┘
                │
                └──→ judge_node (반복, 최대 3회)
                        │
                        ▼ (최적화 완료)
               ┌────────────────┐
               │ 최종 프롬프트   │
               │    출력        │
               └───────┬────────┘
                       ▼
               ┌────────────────┐
               │  Y/N 확인 입력  │
               └───────┬────────┘
                   ┌───┴───┐
                   ▼       ▼
                   Y       N
                   │       │
                   ▼       ▼
            ┌───────────┐ ┌─────┐
            │ LLM 채팅  │ │종료 │
            └───────────┘ └─────┘
```

## 설치 및 실행

```bash
# 1. 의존성 설치 (uv 사용)
uv sync

# 2. .env 파일에 API 키 입력
# OPENAI_API_KEY=sk-...

# 3. 실행
uv run python main.py
```

## 파일 구조

| 파일 | 설명 |
|------|------|
| `state.py` | AgentState TypedDict 정의 (chat_response 포함) |
| `nodes.py` | judge_node, refine_node, chat_with_prompt 구현 |
| `graph.py` | StateGraph 워크플로우 구성 |
| `main.py` | CLI 인터페이스 (Y/N 확인 및 LLM 채팅 포함) |

## 핵심 기능

- **프롬프트 평가**: GPT-4o로 0-100점 품질 평가
- **선택지 생성**: 4가지 구체적인 개선 방향 제안
- **반복 최적화**: 최대 3회 반복, 80점 이상 시 종료
- **상태 보존**: MemorySaver로 체크포인트 관리
- **최종 프롬프트 확인**: 최적화 완료 후 최종 프롬프트 출력
- **LLM 채팅**: Y/N 확인 후 최적화된 프롬프트로 실제 LLM과 대화

## 종료 조건

1. 점수 ≥ 80점
2. 반복 횟수 ≥ 3회

## 실행 예시

```
==================================================
HITL 프롬프트 옵티마이저 (Prompt Optimizer)
==================================================
📝 최적화할 프롬프트를 입력하세요:
> 파이썬 코드 작성해줘

⏳ 프롬프트 분석 중...

────────────────────────────────────────
📊 현재 점수: 35/100 (반복: 1/3)

📋 보완이 필요합니다. 다음 중 하나를 선택하세요:
  1. 어떤 기능의 코드인지 명확히 지정
  2. 입출력 형식 명시
  ...

👉 번호 선택: 1
✏️  추가 내용: 웹 스크래핑

... (최적화 반복) ...

==================================================
✨ 최적화 완료!
==================================================
📊 최종 점수: 85/100
🔄 반복 횟수: 2회

🎯 최종 프롬프트:
──────────────────────────────────────────────────
Python으로 웹 스크래핑 코드를 작성해주세요.
- requests와 BeautifulSoup 라이브러리 사용
- URL을 입력받아 해당 페이지의 제목과 본문 추출
- 에러 처리 포함
──────────────────────────────────────────────────

🤖 이 프롬프트로 LLM과 채팅하시겠습니까? (Y/N): Y

⏳ LLM에 프롬프트 전송 중...

==================================================
💬 LLM 응답:
==================================================
[실제 LLM 응답 출력]
==================================================
```

## 라이선스

MIT

# HITL Prompt Optimizer

LangGraph 기반 Human-in-the-Loop 프롬프트 최적화 도구

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

## 개요

사용자의 모호한 프롬프트를 분석하여 점수를 매기고, 점수에 따라 다른 방식으로 프롬프트를 개선합니다.

**3줄 요약:**
1. 프롬프트 품질을 0-100점으로 평가하고 4가지 개선 방향을 제시합니다.
2. 60점 미만은 직접 입력, 60점 이상은 객관식 질문으로 구체화합니다 (최대 5회).
3. 90점 이상 달성 시 최종 프롬프트로 LLM과 대화할 수 있습니다.

## Claude Code Plugin 설치

### 방법 1: GitHub URL로 직접 설치 (권장)

```bash
# Claude Code 실행 후
/plugin marketplace add stua1125/HITL-prompt-optimizer
/plugin install hitl-prompt-optimizer
```

### 방법 2: 로컬 설치 (개발용)

```bash
# 레포지토리 클론
git clone https://github.com/stua1125/HITL-prompt-optimizer.git

# Claude Code에서 로컬 plugin 로드
claude --plugin-dir ./HITL-prompt-optimizer
```

### Plugin 사용법

```bash
# 프롬프트 최적화 실행
/hitl-prompt-optimizer:optimize [최적화할 프롬프트]

# 예시
/hitl-prompt-optimizer:optimize 코드 작성해줘
```

## 핵심 기능

| 점수 구간 | 모드 | 동작 |
|----------|------|------|
| 0-59점 | 직접 입력 | 보충 필요 내용 안내 → 사용자 직접 입력 |
| 60-89점 | 객관식 | Claude가 질문 생성 → 사용자 선택 (최대 5회) |
| 90점 이상 | 완료 | 최적화 종료 → LLM 채팅 옵션 |

## 아키텍처

```
┌──────────────┐
│  사용자 입력    │
└──────┬───────┘
       ▼
┌──────────────┐
│  judge_node  │ ← 점수 평가 (0-100)
└──────┬───────┘
       │
   ┌───┴───────────┬───────────┐
   ▼               ▼           ▼
 <60점          60-89점      ≥90점
   │               │           │
   ▼               ▼           ▼
┌─────────┐  ┌───────────┐  ┌─────┐
│직접 입력  │  │   객관식    │  │ 완료 │
│  모드    │  │    모드    │  └──┬──┘
└────┬────┘  └─────┬─────┘     │
     │             │           │
     ▼             ▼           │
┌─────────────────────────┐    │
│      human_input        │    │
│    (사용자 입력 대기)       │    │
└───────────┬─────────────┘    │
            ▼                  │
     ┌─────────────┐           │
     │ refine_node │           │
     └──────┬──────┘           │
            │                  │
            └──→ judge_node    │
                    │          │
        ┌───────────┘          │
        ▼                      │
  5회 반복 OR ≥90점 ──────────→│
                               ▼
                    ┌────────────────┐
                    │   최종 프롬프트   │
                    │     출력        │
                    └───────┬────────┘
                            ▼
                    ┌────────────────┐
                    │   Y/N 확인 입력  │
                    └───────┬────────┘
                        ┌───┴───┐
                        ▼       ▼
                        Y       N
                        │       │
                        ▼       ▼
                 ┌───────────┐ ┌─────┐
                 │  LLM 채팅  │ │ 종료 │
                 └───────────┘ └─────┘
```

## 종료 조건

**OR 조건** (둘 중 하나 충족 시 종료):
1. 점수 ≥ 90점
2. 객관식 모드에서 5회 질문 완료

## Standalone 실행 (Plugin 없이)

### 설치

```bash
# 레포지토리 클론
git clone https://github.com/stua1125/HITL-prompt-optimizer.git
cd HITL-prompt-optimizer/scripts

# 의존성 설치 (uv 사용)
uv sync

# .env 파일 설정
cp .env.example .env
# .env 파일에 OPENAI_API_KEY 입력

# 실행
uv run python main.py
```

## Plugin 구조

```
HITL-prompt-optimizer/
├── .claude-plugin/
│   └── plugin.json              # Plugin 메타데이터
├── commands/
│   └── optimize.md              # /hitl-prompt-optimizer:optimize 명령어
├── agents/
│   └── prompt-evaluator.md      # 프롬프트 평가 전문 에이전트
├── skills/
│   └── prompt-optimization/
│       └── SKILL.md             # 자동 활용 스킬
├── scripts/
│   ├── main.py                  # CLI 엔트리포인트
│   ├── nodes.py                 # LLM 노드 로직
│   ├── graph.py                 # LangGraph 워크플로우
│   ├── state.py                 # 상태 정의
│   ├── pyproject.toml           # 의존성 관리
│   └── .env.example             # 환경변수 예시
├── .gitignore
└── README.md
```

## 실행 예시

```
==================================================
HITL 프롬프트 옵티마이저 (Prompt Optimizer)
==================================================
• 60점 미만: 직접 입력 모드
• 60점 이상: 객관식 질문 모드 (최대 5회)
• 90점 이상 달성 시 완료

📝 최적화할 프롬프트를 입력하세요:
> 코드 작성해줘

⏳ 프롬프트 분석 중...

──────────────────────────────────────────────────
📊 현재 점수: 25/100 | 모드: 직접 입력
📄 현재 프롬프트:
   코드 작성해줘...

📝 보충이 필요합니다:
   어떤 프로그래밍 언어로, 어떤 기능의 코드를 원하는지 구체적으로 작성해주세요.

✏️  내용을 입력하세요: Python으로 웹 크롤링 코드

⏳ 프롬프트 개선 중...

──────────────────────────────────────────────────
📊 현재 점수: 65/100 | 객관식 질문: 1/5회

❓ 웹 크롤링의 대상 사이트 유형은 무엇인가요?

  1. 뉴스/기사 사이트
  2. 쇼핑몰/이커머스
  3. SNS/소셜미디어
  4. 기타 일반 웹사이트

👉 번호 선택: 1

... (객관식 반복) ...

==================================================
✨ 최적화 완료!
==================================================
📊 최종 점수: 92/100
🔄 객관식 질문 횟수: 3회

🎯 최종 프롬프트:
──────────────────────────────────────────────────
Python으로 뉴스 사이트 웹 크롤링 코드를 작성해주세요.
- requests와 BeautifulSoup 라이브러리 사용
- 기사 제목, 본문, 작성일 추출
- 결과를 JSON 형식으로 저장
- 에러 처리 및 로깅 포함
──────────────────────────────────────────────────

🤖 이 프롬프트로 LLM과 채팅하시겠습니까? (Y/N): Y

⏳ LLM에 프롬프트 전송 중...

==================================================
💬 LLM 응답:
==================================================
[실제 LLM이 생성한 코드 출력]
==================================================
```

## 요구사항

- Python 3.11+
- OpenAI API Key
- uv 패키지 매니저 (권장)

## 라이선스

MIT
